# This workflow will build a package using Gradle and then publish it to GitHub packages when a release is created
# For more information see: https://github.com/actions/setup-java/blob/main/docs/advanced-usage.md#Publishing-using-gradle

name: build

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write

    steps:
    - name: Build with Gradle
      run: gradle build
    - uses: actions/checkout@master
      id: get_open_pr_count
      with:
          route: GET /repos/RahulVadisetty91/RestService
    - run: "echo latest release: '${{ fromJson(steps.get_open_pr_count.outputs.result).open_issues }}'"
    - uses: actions/checkout@master
    - run: "gradle build"
    - name: "Get Open PR Count of ${{ github.repository }}"
      uses: ./
      id: get_latest_release
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        route: GET /repos/{owner}/{repo}/releases/latest
        owner: RahulVadisetty91
        repo: RestService
    - run: "echo latest release: '${{ fromJson(steps.get_latest_release.outputs.data).open_issues }}'"
